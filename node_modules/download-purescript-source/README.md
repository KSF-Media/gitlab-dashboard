# download-purescript-source

[![npm version](https://img.shields.io/npm/v/download-purescript-source.svg)](https://www.npmjs.com/package/download-purescript-source)
[![Build Status](https://travis-ci.org/shinnn/download-purescript-source.svg?branch=master)](https://travis-ci.org/shinnn/download-purescript-source)
[![Build status](https://ci.appveyor.com/api/projects/status/g23e4elngfla56rm/branch/master?svg=true)](https://ci.appveyor.com/project/ShinnosukeWatanabe/download-purescript-source/branch/master)
[![Coverage Status](https://img.shields.io/coveralls/shinnn/download-purescript-source.svg)](https://coveralls.io/github/shinnn/download-purescript-source?branch=master)

A [Node.js](https://nodejs.org) module to download [PureScript](http://www.purescript.org/) source from [GitHub](https://github.com/)

```javascript
const {readdirSync} = require('fs');
const downloadPurescript = require('download-purescript-source');

downloadPurescript('./dest/').subscribe({
  complete() {
    readdirSync('./dest/');
    /* => [
      'LICENSE',
      'Makefile',
      'Setup.hs',
      'app',
      'bundle',
      'core-tests',
      'license-generator',
      'package.yaml',
      'src',
      'stack.yaml',
      'tests'
    ] */
  }
});
```

## Installation

[Use](https://docs.npmjs.com/cli/install) [npm](https://docs.npmjs.com/getting-started/what-is-npm).

```
npm install download-purescript-source
```

## API

```javascript
const downloadPurescriptSource = require('download-purescript-source');
```

### downloadPurescriptSource(*dir* [, *options*])

*dir*: `string` (a directory path where the PureScript source will be downloaded)  
*options*: `Object`  
Return: [`Observable`](https://github.com/tc39/proposal-observable#observable) ([zenparsing's implementation](https://github.com/zenparsing/zen-observable))

When the `Observable` is [subscribe](https://tc39.github.io/proposal-observable/#observable-prototype-subscribe)d, it starts to download a `tar.gz` archive from the [PureScript GitHub repository](https://github.com/purescript/purescript), extract it and successively send [dl-tar](https://github.com/shinnn/dl-tar)'s [`progress` objects](https://github.com/shinnn/dl-tar#progress) to its [`Observer`](https://github.com/tc39/proposal-observable#observer).

```javascript
downloadPurescriptSource('my/dir')
.filter(({entry}) => entry.bytes === entry.header.size)
.forEach(({entry}) => console.log(`✓ ${entry.header.name}`))
.then(() => console.log('\nCompleted.'));
```

```
✓ LICENSE
✓ Setup.hs
✓ app/
✓ app/Command/
✓ app/Command/Bundle.hs
✓ app/Command/Compile.hs
✓ app/Command/Docs.hs
✓ app/Command/Docs/Ctags.hs
✓ app/Command/Docs/Etags.hs
✓ app/Command/Docs/Html.hs
︙
✓ tests/support/pscide/src/RebuildSpecWithDeps.purs
✓ tests/support/pscide/src/RebuildSpecWithForeign.js
✓ tests/support/pscide/src/RebuildSpecWithForeign.purs
✓ tests/support/pscide/src/RebuildSpecWithHiddenIdent.purs
✓ tests/support/pscide/src/RebuildSpecWithMissingForeign.fail
✓ tests/support/setup-win.cmd

Completed.
```

## Options

You can pass options to [Request](https://github.com/request/request#requestoptions-callback) and [tar-fs](https://github.com/mafintosh/tar-fs)'s [`extract` method](https://github.com/mafintosh/tar-fs/blob/b79d82a79c5e21f6187462d7daaba1fc03cdd1de/index.js#L168). Note that:

* [`strip` option](https://github.com/mafintosh/tar-fs/blob/b79d82a79c5e21f6187462d7daaba1fc03cdd1de/index.js#L48) defaults to `1` and can't be changed. That means the top level directory is always stripped off.
* By default it won't download all `*{md,yml}` files, some specific [files](https://github.com/shinnn/download-purescript-source/blob/7e7feb1ed01830e87506cf0b8361b94490405461/index.js#L32-L34) and [directories](https://github.com/shinnn/download-purescript-source/blob/7e7feb1ed01830e87506cf0b8361b94490405461/index.js#L24-L28) that are unnecessary for building the binary. Pass `() => false` to the [`ignore` option](https://github.com/mafintosh/tar-fs/blob/b79d82a79c5e21f6187462d7daaba1fc03cdd1de/index.js#L173) option if you want to download all files included in the archive.
* [`fs`](https://github.com/mafintosh/tar-fs/blob/b79d82a79c5e21f6187462d7daaba1fc03cdd1de/index.js#L65) option defaults to [graceful-fs](https://github.com/isaacs/node-graceful-fs) for more stability.

Additionally, you can use the following:

### revision

Type: `string`  
Default: [`v0.12.0-rc1`](https://github.com/purescript/purescript/tree/v0.12.0-rc1)

Specify the commit hash, tag or branch name you want to download.

## License

[ISC License](./LICENSE) © 2017 - 2018 Shinnosuke Watanabe
